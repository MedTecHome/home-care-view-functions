rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {  
	  match /{document=**} {
    	//allow read: if exists(/databases/$(database)/documents/profiles/$(request.auth.uid));
      allow read, write: if true;
    }
   	match /profiles/{profile}{
   		allow write: if request.resource.data.role=='patient' && request.resource.data.parent==request.auth.uid;
    	allow update, delete: if request.resource.data.role=='doctor' && request.resource.data.parent==request.auth.uid && get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='clinic';
    	allow create: if request.resource.data.role=='doctor' && request.resource.data.parent==request.auth.uid && get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='clinic' && get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.realDoctors<get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.maxDoctors;
     	allow write: if request.resource.data.role=='clinic' && get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='admin';
      allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role=='superadmin';
    }
    match /medicines/{medicine} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role=='doctor' && resource.data.clinic==get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.parent;
    }
    match /treatments/{treatment} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role=='doctor' && get(/databases/$(database)/documents/profiles/$(resource.data.user)).data.parent==request.auth.uid;
    }    
    match /pressure/{pressure} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }    
     match /temperature/{temperature} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }    
     match /weight/{weight} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }    
     match /glucose/{glucose} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }    
     match /breathing/{breathing} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }    
     match /inr/{inr} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }    
     match /oxygen/{oxygen} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }    
     match /exercises/{exercises} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }   
    match /heartrate/{heartrate} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }    
    match /others/{others} {
    	allow write: if get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role =='patient';
    }    
  }
}